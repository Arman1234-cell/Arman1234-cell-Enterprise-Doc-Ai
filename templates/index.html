<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Enterprise Doc AI â€“ Upload</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style-1.css') }}">
</head>
<body>

<div class="app-wrapper">
  <!-- Sidebar: upload and topics -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h2>Upload PDF</h2>
    </div>

    <div class="upload-section">
      <!-- FORM that talks to /upload -->
      <form id="upload-form" action="/upload" method="POST" enctype="multipart/form-data">
        <input type="file" id="file-input" name="file" accept=".pdf" />
        <button type="submit" id="upload-btn">Upload</button>
      </form>

      <div id="upload-status" style="margin-top:10px; font-size:0.9rem;"></div>

      <span class="topics-label">Detected Topics</span>
      <div id="tag-box"></div>
    </div>
  </aside>

  <!-- Main area: link to chat -->
  <main class="chat-main">
    <header>
      <h1>Enterprise PDF Knowledge</h1>
      <p>First upload one or more PDFs, then go to chat.</p>
      <a class="cta-button" href="{{ url_for('chat_page') }}">Go to Chat</a>
    </header>
  </main>
</div>

<script>
document.getElementById("upload-form").addEventListener("submit", async function (e) {
  e.preventDefault();

  const fileInput = document.getElementById("file-input");
  const statusEl = document.getElementById("upload-status");
  const tagBox = document.getElementById("tag-box");

  if (!fileInput.files.length) {
    statusEl.textContent = "Please select a PDF.";
    return;
  }

  statusEl.textContent = "Uploading...";
  tagBox.innerHTML = "";

  const fd = new FormData();
  fd.append("file", fileInput.files[0]);  // key must be "file"

  try {
    const res = await fetch("/upload", {
      method: "POST",
      body: fd   // no manual Content-Type
    });

    const data = await res.json();
    if (!res.ok) {
      statusEl.textContent = data.error || "Upload failed.";
      return;
    }

    statusEl.textContent = data.message || "Upload successful.";

    if (Array.isArray(data.tags)) {
      data.tags.forEach(t => {
        const span = document.createElement("span");
        span.className = "topic-tag";
        span.textContent = t;
        tagBox.appendChild(span);
      });
    }
  } catch (err) {
    console.error(err);
    statusEl.textContent = "Network error while uploading.";
  }
});
</script>

</body>
</html>
